import{a as we,b as Te}from"./chunk-TP35GJ2Y.js";import"./chunk-IZUREK7C.js";import"./chunk-QBB5J64S.js";import{b as ke}from"./chunk-6IJVIIZO.js";import"./chunk-NAR25S56.js";import"./chunk-VCCA6JQD.js";import"./chunk-FFMKZHPZ.js";import{a as fe}from"./chunk-34JUEJJQ.js";import{a as ge,b as _e,c as be,d as Ee,e as xe,f as Ce,g as Re,h as Se,i as ye}from"./chunk-DHR5AW65.js";import{a as ve}from"./chunk-HCF5RDTS.js";import{a as he}from"./chunk-3TZ6EMP4.js";import{c as me,d as ce}from"./chunk-3RE7YTIY.js";import{a as pe,b as de,c as ue}from"./chunk-KN4JBYXP.js";import{a as ne,b as oe,e as le,f as se}from"./chunk-Y6YWBKM7.js";import{b as X,d as r,f as Y,g as Z,h as D,j as v,l as ee,o as te,p as ae,q as ie,s as re}from"./chunk-Q674NIMA.js";import"./chunk-MUSOTDIH.js";import{a as U,c as W}from"./chunk-7YSBFMG3.js";import"./chunk-I2N33OYR.js";import"./chunk-CARY4E7O.js";import{Z as J,aa as K,j as $}from"./chunk-EKD5RMQ3.js";import{$b as R,Eb as H,Ec as O,Jb as n,Kb as a,Lb as d,Pb as T,Sb as M,Ub as E,Uc as Q,Vc as G,_b as C,ac as S,bb as i,d as _,dc as g,ec as o,ed as z,fc as x,ga as b,gd as j,hc as q,ka as I,lc as A,mc as P,qc as L,sc as V,ta as k,tb as y,ua as w,vc as h,yb as s,zb as u}from"./chunk-X7VXIKXH.js";var De=["contentVer"],Fe=["contentNuevo"],Be=["contentEditar"],Ne=["contentEliminar"],Ie=["contentEliminarSeleccion"];function He(l,t){if(l&1){let e=T();n(0,"app-datatable",13),M("selectionChange",function(c){k(e);let p=E();return w(p.onSelectionChange(c))}),a()}if(l&2){let e=E();s("columns",e.columns)("displayedColumns",e.displayedColumns)("data",e.reservas)("buttons",e.botones)("eliminarSeleccionados",e.modalEliminarSeleccionReservas.bind(e))}}function qe(l,t){l&1&&(n(0,"p"),o(1,"No hay posts."),a())}function Ae(l,t){if(l&1&&(n(0,"div",14)(1,"div",15)(2,"h3"),o(3,"Nombre"),a(),n(4,"p"),o(5),a()(),n(6,"div",15)(7,"h3"),o(8,"Apellidos"),a(),n(9,"p"),o(10),a()(),n(11,"div",15)(12,"h3"),o(13,"Email"),a(),n(14,"p"),o(15),a()(),n(16,"div",15)(17,"h3"),o(18,"Tel\xE9fono"),a(),n(19,"p"),o(20),a()(),n(21,"div",15)(22,"h3"),o(23,"Fecha"),a(),n(24,"p"),o(25),L(26,"date"),a()(),n(27,"div",15)(28,"h3"),o(29,"Hora"),a(),n(30,"p"),o(31),a()()()),l&2){let e=E();i(5),x(e.reserva.nombre),i(5),x(e.reserva.apellidos),i(5),x(e.reserva.email),i(5),x(e.reserva.telefono),i(5),x(V(26,6,e.reserva.fecha,"shortDate")),i(6),x(e.reserva.hora)}}function Pe(l,t){l&1&&(n(0,"button",34),o(1,"Cancelar"),a())}function Le(l,t){l&1&&(n(0,"button",35),o(1,"Confirmar"),a())}function Ve(l,t){if(l&1&&(n(0,"form",16)(1,"mat-grid-list",17)(2,"mat-grid-tile",18)(3,"mat-form-field",19)(4,"mat-label"),o(5,"Nombre:"),a(),d(6,"input",20),a()(),n(7,"mat-grid-tile",18)(8,"mat-form-field",21)(9,"mat-label"),o(10,"Apellidos:"),a(),d(11,"input",22),a()(),n(12,"mat-grid-tile",18)(13,"mat-form-field",23)(14,"mat-label"),o(15,"Email:"),a(),d(16,"input",24),a()(),n(17,"mat-grid-tile",18)(18,"mat-form-field",25)(19,"mat-label"),o(20,"Tel\xE9fono:"),a(),d(21,"input",26),a()(),n(22,"mat-grid-tile",18)(23,"mat-form-field",27)(24,"mat-label"),o(25,"Selecciona una fecha"),a(),d(26,"input",28)(27,"mat-datepicker-toggle",29)(28,"mat-datepicker",null,5),a()(),n(30,"mat-grid-tile",18)(31,"mat-form-field",27)(32,"div",30),d(33,"input",31)(34,"ngx-material-timepicker-toggle",32)(35,"ngx-material-timepicker",33,6),y(37,Pe,2,0,"ng-template",null,7,h)(39,Le,2,0,"ng-template",null,8,h),a()()()()()),l&2){let e=g(29),m=g(36),c=g(38),p=g(40),f=E();s("formGroup",f.nuevaReservaForm),i(),s("rowHeight",f.rowHeight),i(),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(3),s("matDatepicker",e),i(),s("for",e),i(3),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(2),s("ngxTimepicker",m)("disableClick",!0)("format",24),i(),s("for",m),i(),s("theme",f.lahuellaTheme)("cancelBtnTmpl",c)("confirmBtnTmpl",p)}}function Oe(l,t){l&1&&(n(0,"button",34),o(1,"Cancelar"),a())}function Qe(l,t){l&1&&(n(0,"button",35),o(1,"Confirmar"),a())}function Ge(l,t){if(l&1&&(n(0,"form",16)(1,"mat-grid-list",17)(2,"mat-grid-tile",18)(3,"mat-form-field",19)(4,"mat-label"),o(5,"Nombre:"),a(),d(6,"input",36),a()(),n(7,"mat-grid-tile",18)(8,"mat-form-field",21)(9,"mat-label"),o(10,"Apellidos:"),a(),d(11,"input",37),a()(),n(12,"mat-grid-tile",18)(13,"mat-form-field",23)(14,"mat-label"),o(15,"Email:"),a(),d(16,"input",38),a()(),n(17,"mat-grid-tile",18)(18,"mat-form-field",25)(19,"mat-label"),o(20,"Tel\xE9fono:"),a(),d(21,"input",39),a()(),n(22,"mat-grid-tile",18)(23,"mat-form-field",27)(24,"mat-label"),o(25,"Selecciona una fecha"),a(),d(26,"input",40)(27,"mat-datepicker-toggle",29)(28,"mat-datepicker",null,5),a()(),n(30,"mat-grid-tile",18)(31,"mat-form-field",27)(32,"div",30),d(33,"input",41)(34,"ngx-material-timepicker-toggle",32)(35,"ngx-material-timepicker",33,6),y(37,Oe,2,0,"ng-template",null,7,h)(39,Qe,2,0,"ng-template",null,8,h),a()()()()()),l&2){let e=g(29),m=g(36),c=g(38),p=g(40),f=E();s("formGroup",f.editarReservaForm),i(),s("rowHeight",f.rowHeight),i(),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(4),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(3),s("matDatepicker",e),i(),s("for",e),i(3),s("colspan",2)("rowspan",2),i(),u("width",100,"%")("gap",10,"%"),i(2),s("ngxTimepicker",m)("disableClick",!0)("format",24),i(),s("for",m),i(),s("theme",f.lahuellaTheme)("cancelBtnTmpl",c)("confirmBtnTmpl",p)}}function ze(l,t){if(l&1&&(n(0,"div",42),o(1),a()),l&2){let e=E();i(),q(' \xBFEst\xE1s seguro de querer eliminar la reserva de "',e.reserva.nombre," ",e.reserva.apellidos,'"? ')}}function je(l,t){l&1&&(n(0,"div",43),o(1," \xBFEst\xE1s seguro de querer eliminar las reservas seleccionadas? "),d(2,"br"),n(3,"span",44),o(4,"\xA1OJO! Si has pulsado el bot\xF3n para seleccionar todo, se eliminar\xE1n todos las reservas, incluidas aquellas que no aparezcan en la vista actual."),a()())}G(fe,"es");var Me=class l{reservas=[];reserva={};rowHeight="";subscription=[];reservasService=b(ye);dialogService=b(ke);responsiveDesignService=b(he);datatableService=b(we);matsnackbar=b(ve);title=b($);columns=["nombre","apellidos","fecha","hora"];displayedColumns=["select",...this.columns,"acciones"];selectedIds=[];botones=[{id:1,nombre:"Ver",class:"ver",accion:t=>this.modalVerReserva(t)},{id:2,nombre:"Editar",class:"editar",accion:t=>this.modalEditarReserva(t)},{id:3,nombre:"Eliminar",class:"danger",accion:t=>this.modalEliminarReserva(t)}];modalVer;modalNuevo;modalEditar;modalEliminar;modalEliminarSeleccion;nuevaReservaForm=new D({nombre_nuevo:new v("",r.compose([r.required,r.minLength(1)])),apellidos_nuevo:new v("",r.compose([r.required,r.minLength(1)])),email_nuevo:new v("",r.compose([r.required,r.minLength(1),r.email])),telefono_nuevo:new v("",r.compose([r.required,r.min(1)])),fecha_nuevo:new v(new Date,r.compose([r.required,r.minLength(4)])),hora_nuevo:new v("",r.compose([r.required,r.minLength(3)]))});editarReservaForm=new D({nombre_editar:new v("",r.compose([r.required,r.minLength(1)])),apellidos_editar:new v("",r.compose([r.required,r.minLength(1)])),email_editar:new v("",r.compose([r.required,r.minLength(1),r.email])),telefono_editar:new v("",r.compose([r.required,r.min(1)])),fecha_editar:new v(new Date,r.compose([r.required,r.minLength(4)])),hora_editar:new v("",r.compose([r.required,r.minLength(3)]))});ngOnInit(){this.title.setTitle("Reservas < Cl\xEDnica veterinaria La Huella"),this.getReservas(),this.responsiveDesign(),this.subscription.push(this.reservasService.refresh$.subscribe(()=>{this.getReservas()}))}ngOnDestroy(){this.subscription.forEach(t=>t.unsubscribe())}getReservas(){this.reservasService.getAllBookings().subscribe({next:t=>{this.reservas=t.data,this.reservas.forEach(e=>{e.fecha=Q(new Date(e.fecha),"dd/MM/yyyy","es-ES")})},error:t=>{t.status===404?this.matsnackbar.open("Reserva no encontrada.","Aceptar",{duration:3e3}):this.matsnackbar.open("Ha ocurrido un error al buscar las reservas.","Aceptar",{duration:3e3})}})}modalVerReserva(t){return _(this,null,function*(){let e="Ver reserva",m="cancelar";this.getReserva(t),yield this.dialogService.openDialog({html:this.modalVer,title:e,btnCancel:m})})}getReserva(t){this.reservasService.getBooking(t).subscribe({next:e=>{this.reserva=e.data[0]},error:e=>{e.status===404?this.matsnackbar.open("Reserva no encontrada.","Aceptar",{duration:3e3}):this.matsnackbar.open("Ha ocurrido un error al buscar la reserva.","Aceptar",{duration:3e3})}})}modalCrearReserva(){return _(this,null,function*(){yield this.dialogService.openDialog({html:this.modalNuevo,title:"Nueva reserva",btnCancel:"cancelar",btnClass:"guardar"}).then(c=>{c&&this.crearReserva()})})}crearReserva(){if(this.nuevaReservaForm.valid){let t={nombre:this.nuevaReservaForm.value.nombre_nuevo||"",apellidos:this.nuevaReservaForm.value.apellidos_nuevo||"",email:this.nuevaReservaForm.value.email_nuevo||"",telefono:this.nuevaReservaForm.value.telefono_nuevo||void 0,fecha:this.nuevaReservaForm.value.fecha_nuevo?.toLocaleDateString("en-CA")||"",hora:this.nuevaReservaForm.value.hora_nuevo||""};this.reservasService.postBooking(t).subscribe({next:e=>{this.matsnackbar.open("Reserva creada.","Aceptar",{duration:3e3})},error:e=>{this.matsnackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}}modalEditarReserva(t){return _(this,null,function*(){let e="Editar reserva",m="cancelar",c="guardar";this.reservasService.getBooking(t).subscribe(p=>{if(p.data){let f=p.data[0].hora,F=f.slice(0,2),B=f.slice(3,5),N=new Date;N.setHours(F),N.setMinutes(B),this.editarReservaForm.patchValue({nombre_editar:p.data[0].nombre,apellidos_editar:p.data[0].apellidos,email_editar:p.data[0].email,telefono_editar:p.data[0].telefono,fecha_editar:new Date(p.data[0].fecha),hora_editar:F+":"+B})}}),yield this.dialogService.openDialog({html:this.modalEditar,title:e,btnCancel:m,btnClass:c}).then(p=>{p&&this.editarReserva(t)})})}editarReserva(t){if(this.editarReservaForm.valid){let e={nombre:this.editarReservaForm.value.nombre_editar||"",apellidos:this.editarReservaForm.value.apellidos_editar||"",email:this.editarReservaForm.value.email_editar||"",telefono:this.editarReservaForm.value.telefono_editar||"",fecha:this.editarReservaForm.value.fecha_editar?.toLocaleDateString("en-CA")||"",hora:this.editarReservaForm.value.hora_editar||""};this.reservasService.updateBooking(t,e).subscribe({next:m=>{this.matsnackbar.open("Reserva actualizada.","Aceptar",{duration:3e3})},error:m=>{m.status===404?this.matsnackbar.open("Reserva no encontrada.","Aceptar",{duration:3e3}):this.matsnackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}}modalEliminarReserva(t){return _(this,null,function*(){let e="Eliminar reserva",m="eliminar",c="cancelar";this.reservasService.getBooking(t).subscribe({next:p=>_(this,null,function*(){this.reserva=p.data[0],yield this.dialogService.openDialog({html:this.modalEliminar,title:e,btnClass:m,btnCancel:c}).then(f=>{f&&this.eliminarReserva(t)})}),error:p=>{p.status===404?this.matsnackbar.open("Reserva no encontrada.","Aceptar",{duration:3e3}):this.matsnackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})})}eliminarReserva(t){this.reservasService.deleteBooking(t).subscribe({next:e=>{this.matsnackbar.open("Reserva eliminada.","Aceptar",{duration:3e3})},error:e=>{this.matsnackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalEliminarSeleccionReservas(){return _(this,null,function*(){yield this.dialogService.openDialog({html:this.modalEliminarSeleccion,title:"Eliminar reservas",btnClass:"eliminar",btnCancel:"cancelar"}).then(c=>{c&&this.eliminarReservas()})})}eliminarReservas(){this.reservasService.deleteBookings(this.selectedIds).subscribe({next:t=>{this.matsnackbar.open("Reservas eliminadas.","Aceptar",{duration:3e3}),this.datatableService._observable$.next()},error:t=>{t.status===404?this.matsnackbar.open("Reservas no encontradas.","Aceptar",{duration:3e3}):this.matsnackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}onSelectionChange(t){this.selectedIds=t}responsiveDesign(){this.subscription.push(this.responsiveDesignService.obtenerDispositivo().subscribe({next:t=>{switch(t){case"M\xF3vil":this.rowHeight="3:1";break;case"Tablet":this.rowHeight="4:1";break;default:this.rowHeight="8:1";break}},error:t=>{console.error(t)}}))}lahuellaTheme={container:{bodyBackgroundColor:"#fff",buttonColor:"#ce984c"},dial:{dialBackgroundColor:"#ce984c"},clockFace:{clockFaceBackgroundColor:"#4c5462",clockHandColor:"#ce984c",clockFaceTimeInactiveColor:"#fff"}};static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-reservas"]],viewQuery:function(e,m){if(e&1&&(C(De,5),C(Fe,5),C(Be,5),C(Ne,5),C(Ie,5)),e&2){let c;R(c=S())&&(m.modalVer=c.first),R(c=S())&&(m.modalNuevo=c.first),R(c=S())&&(m.modalEditar=c.first),R(c=S())&&(m.modalEliminar=c.first),R(c=S())&&(m.modalEliminarSeleccion=c.first)}},standalone:!0,features:[A([K(),{provide:J,useValue:"es-ES"},{provide:O,useValue:"es"}]),P],decls:19,vars:1,consts:[["contentVer",""],["contentNuevo",""],["contentEditar",""],["contentEliminar",""],["contentEliminarSeleccion",""],["picker",""],["toggleTimepicker",""],["cancelBtn",""],["confirmBtn",""],[1,"encabezado","flex","flex-row","items-center","gap-6"],["mat-stroked-button","",1,"nuevo",3,"click"],[1,"reservas"],[3,"columns","displayedColumns","data","buttons","eliminarSeleccionados"],[3,"selectionChange","columns","displayedColumns","data","buttons","eliminarSeleccionados"],[1,"modalVer"],[1,"mensaje-data"],[3,"formGroup"],["cols","2",1,"input-list",3,"rowHeight"],[3,"colspan","rowspan"],[1,"nombre-input","form-field"],["type","text","matInput","","placeholder","","value","","formControlName","nombre_nuevo","required",""],[1,"apellidos-input","form-field"],["type","text","matInput","","placeholder","","value","","formControlName","apellidos_nuevo","required",""],[1,"email-input","form-field"],["type","email","matInput","","placeholder","","value","","formControlName","email_nuevo","required",""],[1,"telefono-input","form-field"],["type","text","matInput","","placeholder","","value","","formControlName","telefono_nuevo","required",""],[1,"fecha-input","form-field"],["matInput","","formControlName","fecha_nuevo",3,"matDatepicker"],["matIconSuffix","",3,"for"],[1,"flex","items-start"],["matInput","","aria-label","Seleccionar hora","placeholder","Selecciona una hora","readonly","","formControlName","hora_nuevo",3,"ngxTimepicker","disableClick","format"],[3,"for"],[3,"theme","cancelBtnTmpl","confirmBtnTmpl"],[2,"margin-right","10px"],[2,"color","var(--lightbrown)"],["type","text","matInput","","placeholder","","formControlName","nombre_editar","required",""],["type","text","matInput","","placeholder","","formControlName","apellidos_editar","required",""],["type","email","matInput","","placeholder","","formControlName","email_editar","required",""],["type","text","matInput","","placeholder","","formControlName","telefono_editar","required",""],["matInput","","formControlName","fecha_editar",3,"matDatepicker"],["matInput","","aria-label","Seleccionar hora","placeholder","Selecciona una hora","readonly","","formControlName","hora_editar",3,"ngxTimepicker","disableClick","format"],[1,"modalEliminar"],[1,"modalEliminarSeleccion"],[1,"caution"]],template:function(e,m){if(e&1){let c=T();n(0,"main")(1,"section",9)(2,"h1"),o(3,"Reservas"),a(),n(4,"button",10),M("click",function(){return k(c),w(m.modalCrearReserva())}),o(5,"A\xF1adir reserva"),a()(),n(6,"section",11),y(7,He,1,5,"app-datatable",12)(8,qe,2,0,"p"),a()(),y(9,Ae,32,9,"ng-template",null,0,h)(11,Ve,41,47,"ng-template",null,1,h)(13,Ge,41,47,"ng-template",null,2,h)(15,ze,2,2,"ng-template",null,3,h)(17,je,5,0,"ng-template",null,4,h)}e&2&&(i(7),H(m.reservas?7:8))},dependencies:[W,U,Te,se,le,ne,oe,ce,me,ue,de,pe,Se,xe,Ce,Re,Ee,ge,_e,be,re,ee,X,Y,Z,ie,te,ae,j,z],styles:["main[_ngcontent-%COMP%]{margin:0 2rem}.encabezado[_ngcontent-%COMP%]{margin:1rem 0}h1[_ngcontent-%COMP%]{font-size:var(--lengthLg1)}div.mensaje-data[_ngcontent-%COMP%]{margin:1rem 0}h3[_ngcontent-%COMP%]{font-size:var(--lengthMd2)}button.nuevo[_ngcontent-%COMP%]{color:var(--dark)}.example-full-width[_ngcontent-%COMP%]{width:100%}.caution[_ngcontent-%COMP%]{color:red}"]})};export{Me as ReservasComponent};
