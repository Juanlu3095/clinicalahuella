import{a as ae,b as ie}from"./chunk-II5F7BV4.js";import"./chunk-IZUREK7C.js";import"./chunk-QBB5J64S.js";import{a as te,b as ne}from"./chunk-6IJVIIZO.js";import"./chunk-NAR25S56.js";import"./chunk-VCCA6JQD.js";import"./chunk-FFMKZHPZ.js";import{a as ee}from"./chunk-BCVMZDEH.js";import{a as Z}from"./chunk-HCF5RDTS.js";import{a as I,c as X,d as Y}from"./chunk-3RE7YTIY.js";import{a as J,e as K,f as W}from"./chunk-Y6YWBKM7.js";import{b as H,d as a,f as L,g as O,h as y,j as u,l as z,m as P,o as Q,p as B,q as G,r as U,s as $}from"./chunk-Q674NIMA.js";import"./chunk-YOT3GOMZ.js";import{a as R,c as V}from"./chunk-7YSBFMG3.js";import"./chunk-I2N33OYR.js";import"./chunk-CARY4E7O.js";import{j as N}from"./chunk-EKD5RMQ3.js";import{$b as h,Eb as k,Jb as i,Kb as n,Lb as d,Pb as S,Sb as w,Ub as p,_b as j,ac as b,bb as c,d as A,e as F,ec as o,fc as f,ga as g,hc as D,ka as q,mc as T,ta as _,tb as C,ua as E,vc as M,yb as v,zb as x}from"./chunk-X7VXIKXH.js";var ue=["contentVer"],pe=["contentNuevo"],fe=["contentEditar"],ge=["contentEliminar"],je=["contentEliminarSeleccion"];function he(l,t){if(l&1){let e=S();i(0,"app-datatable",11),w("selectionChange",function(s){_(e);let m=p();return E(m.onSelectionChange(s))}),n()}if(l&2){let e=p();v("columns",e.columns)("displayedColumns",e.displayedColumns)("data",e.mensajes)("buttons",e.botones)("eliminarSeleccionados",e.modalDeleteSeleccionMensajes.bind(e))}}function be(l,t){l&1&&(i(0,"p"),o(1,"No hay mensajes."),n())}function Me(l,t){if(l&1&&(i(0,"div",12)(1,"div",13)(2,"h3"),o(3,"Nombre"),n(),i(4,"p"),o(5),n()(),i(6,"div",13)(7,"h3"),o(8,"Apellidos"),n(),i(9,"p"),o(10),n()(),i(11,"div",13)(12,"h3"),o(13,"Email"),n(),i(14,"p"),o(15),n()(),i(16,"div",13)(17,"h3"),o(18,"Tel\xE9fono"),n(),i(19,"p"),o(20),n()(),i(21,"div",13)(22,"h3"),o(23,"Asunto"),n(),i(24,"p"),o(25),n()(),i(26,"div",13)(27,"h3"),o(28,"Mensaje"),n(),i(29,"p"),o(30),n()()()),l&2){let e=p();c(5),f(e.mensajeVer.nombre),c(5),f(e.mensajeVer.apellidos),c(5),f(e.mensajeVer.email),c(5),f(e.mensajeVer.telefono),c(5),f(e.mensajeVer.asunto),c(5),f(e.mensajeVer.mensaje)}}function ve(l,t){if(l&1&&(i(0,"div",14)(1,"form",15)(2,"mat-form-field",16)(3,"mat-label"),o(4,"Nombre"),n(),d(5,"input",17),n(),i(6,"mat-form-field",16)(7,"mat-label"),o(8,"Apellidos"),n(),d(9,"input",18),n(),i(10,"mat-form-field",16)(11,"mat-label"),o(12,"Email"),n(),d(13,"input",19),n(),i(14,"mat-form-field",16)(15,"mat-label"),o(16,"Tel\xE9fono"),n(),d(17,"input",20),n(),i(18,"mat-form-field",16)(19,"mat-label"),o(20,"Asunto"),n(),d(21,"input",21),n(),i(22,"mat-form-field",22)(23,"mat-label"),o(24,"Mensaje"),n(),d(25,"textarea",23,5),n()()()),l&2){let e=p();c(),v("formGroup",e.crearMensajeForm),c(21),x("width",100,"%")}}function _e(l,t){if(l&1&&(i(0,"div",24)(1,"form",15)(2,"mat-form-field",16)(3,"mat-label"),o(4,"Nombre"),n(),d(5,"input",25),n(),i(6,"mat-form-field",16)(7,"mat-label"),o(8,"Apellidos"),n(),d(9,"input",26),n(),i(10,"mat-form-field",16)(11,"mat-label"),o(12,"Email"),n(),d(13,"input",27),n(),i(14,"mat-form-field",16)(15,"mat-label"),o(16,"Tel\xE9fono"),n(),d(17,"input",28),n(),i(18,"mat-form-field",16)(19,"mat-label"),o(20,"Asunto"),n(),d(21,"input",29),n(),i(22,"mat-form-field",22)(23,"mat-label"),o(24,"Mensaje"),n(),d(25,"textarea",30,5),n()()()),l&2){let e=p();c(),v("formGroup",e.editarMensajeForm),c(21),x("width",100,"%")}}function Ee(l,t){if(l&1&&(i(0,"div",31),o(1),n()),l&2){let e=p();c(),D(' \xBFEst\xE1s seguro de querer eliminar el mensaje de "',e.mensaje.nombre," ",e.mensaje.apellidos,'"? ')}}function Ce(l,t){l&1&&(i(0,"div",32),o(1," \xBFEst\xE1s seguro de querer eliminar los mensajes seleccionados? "),d(2,"br"),i(3,"span",33),o(4,"\xA1OJO! Si has pulsado el bot\xF3n para seleccionar todo, se eliminar\xE1n todos los mensajess, incluidos aquellos que no aparezcan en la vista actual."),n()())}var oe=class l{mensajeService=g(ee);snackbar=g(Z);datatableService=g(ae);dialogService=g(ne);title=g(N);mensajes=[];mensaje={};mensajeVer={};columns=["nombre","apellidos","asunto","fecha"];displayedColumns=["select",...this.columns,"acciones"];selectedIds=[];suscripcion=new F;botones=[{id:1,nombre:"Ver",class:"ver",accion:t=>this.modalVerMensaje(t)},{id:2,nombre:"Editar",class:"editar",accion:t=>this.modalUpdateMensaje(t)},{id:3,nombre:"Eliminar",class:"danger",accion:t=>this.modalDeleteMensaje(t)}];modalVer;modalNuevo;modalEditar;modalEliminar;modalEliminarSeleccion;crearMensajeForm=new y({nombre_nuevo:new u("",a.compose([a.required,a.minLength(1)])),apellidos_nuevo:new u("",a.compose([a.required,a.minLength(1)])),email_nuevo:new u("",a.compose([a.required,a.minLength(1),a.email])),telefono_nuevo:new u("",a.compose([a.required,a.min(1)])),asunto_nuevo:new u("",a.compose([a.required,a.minLength(1)])),mensaje_nuevo:new u("",a.compose([a.required,a.minLength(1)]))});editarMensajeForm=new y({nombre_editar:new u("",a.compose([a.required,a.minLength(1)])),apellidos_editar:new u("",a.compose([a.required,a.minLength(1)])),email_editar:new u("",a.compose([a.required,a.minLength(1),a.email])),telefono_editar:new u("",a.compose([a.required,a.min(1)])),asunto_editar:new u("",a.compose([a.required,a.minLength(1)])),mensaje_editar:new u("",a.compose([a.required,a.minLength(1)]))});ngOnInit(){this.title.setTitle("Mensajes < Cl\xEDnica veterinaria La Huella"),this.getMensajes(),this.suscripcion=this.mensajeService.refresh$.subscribe(()=>{this.getMensajes()})}ngOnDestroy(){this.suscripcion.unsubscribe()}getMensajes(){this.mensajeService.getMessages().subscribe({next:t=>{t.data.forEach(r=>{r.created_at=new Date(r.created_at).toLocaleString()});let e=[...t.data];e=e.map(r=>{let{id:s,nombre:m,apellidos:re,email:se,telefono:le,asunto:me,mensaje:de,created_at:ce}=r;return{id:s,nombre:m,apellidos:re,email:se,telefono:le,asunto:me,mensaje:de,fecha:ce}}),this.mensajes=e},error:t=>{t.status===404?this.snackbar.open("Categor\xEDas no encontradas.","Aceptar",{duration:3e3}):console.error(t)}})}modalVerMensaje(t){return A(this,null,function*(){let e="Ver mensaje",r="cancelar";this.getMensaje(t),yield this.dialogService.openDialog({html:this.modalVer,title:e,btnCancel:r})})}getMensaje(t){this.mensajeService.getMessage(t).subscribe({next:e=>{this.mensajeVer=e.data},error:e=>{e.status===404?this.snackbar.open("Mensaje no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalPostMensaje(){this.dialogService.openDialog({html:this.modalNuevo,title:"Nuevo mensaje",btnClass:"guardar",btnCancel:"cancelar"}).then(s=>{s&&this.crearMensajeForm.valid&&this.postMensaje()})}postMensaje(){let t={nombre:this.crearMensajeForm.value.nombre_nuevo||"",apellidos:this.crearMensajeForm.value.apellidos_nuevo||"",email:this.crearMensajeForm.value.email_nuevo||"",telefono:this.crearMensajeForm.value.telefono_nuevo||"",asunto:this.crearMensajeForm.value.asunto_nuevo||"",mensaje:this.crearMensajeForm.value.mensaje_nuevo||""};this.mensajeService.postMessage(t).subscribe({next:e=>{this.snackbar.open("Mensaje creado.","Aceptar",{duration:3e3})},error:e=>{e.status===422?this.snackbar.open("Los datos enviados no son correctos.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalUpdateMensaje(t){let e="Editar mensaje",r="guardar",s="cancelar";this.mensajeService.getMessage(t).subscribe({next:m=>{this.editarMensajeForm.patchValue({nombre_editar:m.data.nombre,apellidos_editar:m.data.apellidos,email_editar:m.data.email,telefono_editar:m.data.telefono,asunto_editar:m.data.asunto,mensaje_editar:m.data.mensaje})},error:m=>{m.status===404?this.snackbar.open("Mensaje no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}}),this.dialogService.openDialog({html:this.modalEditar,title:e,btnClass:r,btnCancel:s}).then(m=>{m&&this.editarMensajeForm.valid&&this.updateMensaje(t)})}updateMensaje(t){let e={nombre:this.editarMensajeForm.value.nombre_editar||"",apellidos:this.editarMensajeForm.value.apellidos_editar||"",email:this.editarMensajeForm.value.email_editar||"",telefono:this.editarMensajeForm.value.telefono_editar||"",asunto:this.editarMensajeForm.value.asunto_editar||"",mensaje:this.editarMensajeForm.value.mensaje_editar||""};this.mensajeService.updateMessage(t,e).subscribe({next:r=>{this.snackbar.open("Mensaje actualizado.","Aceptar",{duration:3e3})},error:r=>{r.status===404?this.snackbar.open("Mensaje no encontrado.","Aceptar",{duration:3e3}):r.status===422?this.snackbar.open("Los datos enviados no son correctos.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalDeleteMensaje(t){let e="Eliminar mensaje",r="eliminar",s="cancelar";this.mensajeService.getMessage(t).subscribe({next:m=>{this.mensaje=m.data},error:m=>{m.status===404?this.snackbar.open("Mensaje no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}}),this.dialogService.openDialog({html:this.modalEliminar,title:e,btnClass:r,btnCancel:s}).then(m=>{m&&this.deleteMensaje(t)})}deleteMensaje(t){this.mensajeService.deleteMessage(t).subscribe({next:e=>{this.snackbar.open("Mensaje eliminado.","Aceptar",{duration:3e3})},error:e=>{e.status===404?this.snackbar.open("Mensaje no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalDeleteSeleccionMensajes(){this.dialogService.openDialog({html:this.modalEliminarSeleccion,title:"Eliminar mensajes",btnClass:"eliminar",btnCancel:"cancelar"}).then(s=>{s&&this.deleteMensajes()})}deleteMensajes(){this.mensajeService.deleteMessages(this.selectedIds).subscribe({next:t=>{this.snackbar.open("Mensajes eliminados.","Aceptar",{duration:3e3}),this.datatableService._observable$.next()},error:t=>{console.error(t)}})}onSelectionChange(t){this.selectedIds=t}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=q({type:l,selectors:[["app-mensajes"]],viewQuery:function(e,r){if(e&1&&(j(ue,5),j(pe,5),j(fe,5),j(ge,5),j(je,5)),e&2){let s;h(s=b())&&(r.modalVer=s.first),h(s=b())&&(r.modalNuevo=s.first),h(s=b())&&(r.modalEditar=s.first),h(s=b())&&(r.modalEliminar=s.first),h(s=b())&&(r.modalEliminarSeleccion=s.first)}},standalone:!0,features:[T],decls:20,vars:1,consts:[["contentVer",""],["contentNuevo",""],["contentEditar",""],["contentEliminar",""],["contentEliminarSeleccion",""],["autosize","cdkTextareaAutosize"],[1,"encabezado","flex","flex-row","items-center","gap-6"],["mat-stroked-button","",1,"nuevo",3,"click"],[1,"mensajes"],[1,"tabla-mensajes"],[3,"columns","displayedColumns","data","buttons","eliminarSeleccionados"],[3,"selectionChange","columns","displayedColumns","data","buttons","eliminarSeleccionados"],[1,"modalVer"],[1,"mensaje-data"],[1,"modalNuevo"],[1,"nuevomensaje-form",3,"formGroup"],[1,"example-full-width"],["matInput","","formControlName","nombre_nuevo","ngDefaultControl","","required",""],["matInput","","formControlName","apellidos_nuevo","ngDefaultControl","","required",""],["matInput","","formControlName","email_nuevo","ngDefaultControl","","required",""],["matInput","","formControlName","telefono_nuevo","type","number","ngDefaultControl","","required",""],["matInput","","formControlName","asunto_nuevo","ngDefaultControl","","required",""],[1,"textarea-input","example-full-width"],["matInput","","cdkTextareaAutosize","","cdkAutosizeMinRows","7","cdkAutosizeMaxRows","10","type","textarea","formControlName","mensaje_nuevo","required",""],[1,"modalEditar"],["matInput","","formControlName","nombre_editar","ngDefaultControl","","required",""],["matInput","","formControlName","apellidos_editar","ngDefaultControl","","required",""],["matInput","","formControlName","email_editar","ngDefaultControl","","required",""],["matInput","","formControlName","telefono_editar","type","text","ngDefaultControl","","required",""],["matInput","","formControlName","asunto_editar","ngDefaultControl","","required",""],["matInput","","cdkTextareaAutosize","","cdkAutosizeMinRows","7","cdkAutosizeMaxRows","10","type","textarea","formControlName","mensaje_editar","required",""],[1,"modalEliminar"],[1,"modalEliminarSeleccion"],[1,"caution"]],template:function(e,r){if(e&1){let s=S();i(0,"main")(1,"section",6)(2,"h1"),o(3,"Mensajes"),n(),i(4,"button",7),w("click",function(){return _(s),E(r.modalPostMensaje())}),o(5,"A\xF1adir mensaje"),n()(),i(6,"section",8)(7,"div",9),C(8,he,1,5,"app-datatable",10)(9,be,2,0,"p"),n()()(),C(10,Me,31,6,"ng-template",null,0,M)(12,ve,27,3,"ng-template",null,1,M)(14,_e,27,3,"ng-template",null,2,M)(16,Ee,2,2,"ng-template",null,3,M)(18,Ce,5,0,"ng-template",null,4,M)}e&2&&(c(8),k(r.mensajes?8:9))},dependencies:[ie,V,R,W,K,J,Y,X,I,te,$,z,H,P,L,O,G,Q,B,U],styles:["main[_ngcontent-%COMP%]{margin:0 2rem}.encabezado[_ngcontent-%COMP%]{margin:1rem 0}h1[_ngcontent-%COMP%]{font-size:var(--lengthLg1)}div.mensaje-data[_ngcontent-%COMP%]{margin:1rem 0}h3[_ngcontent-%COMP%]{font-size:var(--lengthMd2)}button.nuevo[_ngcontent-%COMP%]{color:var(--dark)}.example-full-width[_ngcontent-%COMP%]{width:100%}.caution[_ngcontent-%COMP%]{color:red}"]})};export{oe as MensajesComponent};
