import{a as W,b as X}from"./chunk-LR6ULQRQ.js";import"./chunk-IZUREK7C.js";import"./chunk-QBB5J64S.js";import{b as U}from"./chunk-6IJVIIZO.js";import"./chunk-NAR25S56.js";import{a as J}from"./chunk-4JW6P33Q.js";import"./chunk-VCCA6JQD.js";import"./chunk-FFMKZHPZ.js";import{a as K}from"./chunk-HCF5RDTS.js";import{c as $,d as j}from"./chunk-3RE7YTIY.js";import{a as B,e as G,f as z}from"./chunk-Y6YWBKM7.js";import{b as O,d as c,f as P,g as H,h as S,j as x,l as q,o as I,p as V,q as Q,s as L}from"./chunk-Q674NIMA.js";import"./chunk-FIRHHLGJ.js";import{a as D,c as k}from"./chunk-7YSBFMG3.js";import"./chunk-I2N33OYR.js";import"./chunk-CARY4E7O.js";import{j as R}from"./chunk-EKD5RMQ3.js";import{$b as w,Eb as M,Jb as s,Kb as o,Lb as g,Pb as v,Sb as E,Ub as d,_b as u,ac as f,bb as p,e as y,ec as l,ga as m,gc as A,ka as F,mc as T,ta as N,tb as _,ua as C,vc as h,yb as b}from"./chunk-X7VXIKXH.js";var ee=["contentNuevo"],te=["contentEditar"],ie=["contentEliminar"],re=["contentEliminarSeleccion"];function ne(n,t){if(n&1){let e=v();s(0,"app-datatable",8),E("selectionChange",function(r){N(e);let a=d();return C(a.onSelectionChange(r))}),o()}if(n&2){let e=d();b("columns",e.columns)("displayedColumns",e.displayedColumns)("data",e.newsletters)("buttons",e.botones)("eliminarSeleccionados",e.modalEliminarSeleccionNewsletters.bind(e))}}function ae(n,t){n&1&&(s(0,"p"),l(1,"No hay posts."),o())}function oe(n,t){if(n&1&&(s(0,"div",9)(1,"form",10)(2,"mat-form-field",11)(3,"mat-label"),l(4,"Email"),o(),g(5,"input",12),o()()()),n&2){let e=d();p(),b("formGroup",e.crearNewsForm)}}function se(n,t){if(n&1&&(s(0,"div",13)(1,"form",10)(2,"mat-form-field",11)(3,"mat-label"),l(4,"Email"),o(),g(5,"input",14),o()()()),n&2){let e=d();p(),b("formGroup",e.editarNewsForm)}}function le(n,t){if(n&1&&(s(0,"div",15),l(1),o()),n&2){let e=d();p(),A(' \xBFEst\xE1s seguro de querer eliminar la suscripci\xF3n de "',e.newsletter.email,'"? ')}}function ce(n,t){n&1&&(s(0,"div",16),l(1," \xBFEst\xE1s seguro de querer las suscripciones seleccionadas? "),g(2,"br"),s(3,"span",17),l(4,"\xA1OJO! Si has pulsado el bot\xF3n para seleccionar todo, se eliminar\xE1n todos las suscripciones, incluidas aquellas que no aparezcan en la vista actual."),o()())}var Y=class n{newsletterService=m(J);snackbar=m(K);title=m(R);datatableService=m(W);dialogService=m(U);newsletters=[];newsletter={};columns=["email","fecha"];displayedColumns=["select",...this.columns,"acciones"];selectedIds=[];suscripcion=new y;botones=[{id:1,nombre:"Editar",class:"editar",accion:t=>this.modalEditarNewsletter(t)},{id:2,nombre:"Eliminar",class:"danger",accion:t=>this.modalDeleteNewsletter(t)}];modalNuevo;modalEditar;modalEliminar;modalEliminarSeleccion;crearNewsForm=new S({email_nuevo:new x("",c.compose([c.required,c.email]))});editarNewsForm=new S({email_editar:new x("",c.compose([c.required,c.email]))});constructor(){}ngOnInit(){this.title.setTitle("Newsletters < Cl\xEDnica veterinaria La Huella"),this.getAllNewsletters(),this.suscripcion=this.newsletterService.refresh$.subscribe(()=>{this.getAllNewsletters()})}ngOnDestroy(){this.suscripcion.unsubscribe()}getAllNewsletters(){this.newsletterService.getNewsletters().subscribe({next:t=>{t.data.forEach(i=>{i.created_at=new Date(i.created_at).toLocaleString()});let e=[...t.data];e=e.map(i=>{let{id:r,email:a,created_at:Z}=i;return{id:r,email:a,fecha:Z}}),this.newsletters=e},error:t=>{this.snackbar.open("No se han podido obtener las newsletters.","Aceptar",{duration:3e3})}})}modalCrearNewsletter(){this.dialogService.openDialog({html:this.modalNuevo,title:"Nueva suscripci\xF3n",btnClass:"guardar",btnCancel:"cancelar"}).then(r=>{r&&this.crearNewsForm.valid&&this.crearNewsletter()})}crearNewsletter(){let t={email:this.crearNewsForm.value.email_nuevo||""};this.newsletterService.postNewsletter(t).subscribe({next:e=>{this.snackbar.open("Newsletter creada.","Aceptar",{duration:3e3})},error:e=>{this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalEditarNewsletter(t){let e="Editar suscripci\xF3n",i="guardar",r="cancelar";this.newsletterService.getNewsletter(t).subscribe(a=>{this.editarNewsForm.patchValue({email_editar:a.data.email})}),this.dialogService.openDialog({html:this.modalEditar,title:e,btnClass:i,btnCancel:r}).then(a=>{a&&this.editarNewsForm.valid&&this.editarNewsletter(t)})}editarNewsletter(t){let e={email:this.editarNewsForm.value.email_editar||""};this.newsletterService.updateNewsletter(t,e).subscribe({next:i=>{this.snackbar.open("Newsletter actualizada.","Aceptar",{duration:3e3})},error:i=>{i.status===404?this.snackbar.open("No se ha encontrado el registro.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalDeleteNewsletter(t){let e="Eliminar suscripci\xF3n",i="eliminar",r="cancelar";this.newsletterService.getNewsletter(t).subscribe(a=>{this.newsletter=a.data}),this.dialogService.openDialog({html:this.modalEliminar,title:e,btnClass:i,btnCancel:r}).then(a=>{a&&this.eliminarNewsletter(t)})}eliminarNewsletter(t){this.newsletterService.deleteNewsletter(t).subscribe({next:e=>{this.snackbar.open("Newsletter eliminada.","Aceptar",{duration:3e3})},error:e=>{e.status===404?this.snackbar.open("No se ha encontrado el registro.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalEliminarSeleccionNewsletters(){this.dialogService.openDialog({html:this.modalEliminarSeleccion,title:"Eliminar suscripciones",btnClass:"eliminar",btnCancel:"cancelar"}).then(r=>{r&&this.eliminarSeleccionNewsletters()})}eliminarSeleccionNewsletters(){this.newsletterService.deleteSelectedNewsletter(this.selectedIds).subscribe({next:t=>{this.snackbar.open("Suscripciones eliminadas.","Aceptar",{duration:3e3}),this.datatableService._observable$.next()},error:t=>{t.status===404?this.snackbar.open("No se han encontrado los registros.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}onSelectionChange(t){this.selectedIds=t}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-newsletters"]],viewQuery:function(e,i){if(e&1&&(u(ee,5),u(te,5),u(ie,5),u(re,5)),e&2){let r;w(r=f())&&(i.modalNuevo=r.first),w(r=f())&&(i.modalEditar=r.first),w(r=f())&&(i.modalEliminar=r.first),w(r=f())&&(i.modalEliminarSeleccion=r.first)}},standalone:!0,features:[T],decls:17,vars:1,consts:[["contentNuevo",""],["contentEditar",""],["contentEliminar",""],["contentEliminarSeleccion",""],[1,"encabezado","flex","flex-row","items-center","gap-6"],["mat-stroked-button","",1,"nuevo",3,"click"],[1,"newsletters"],[3,"columns","displayedColumns","data","buttons","eliminarSeleccionados"],[3,"selectionChange","columns","displayedColumns","data","buttons","eliminarSeleccionados"],[1,"modalNuevo"],[1,"newsletter-form",3,"formGroup"],[1,"example-full-width"],["matInput","","placeholder","Indica el email","formControlName","email_nuevo","ngDefaultControl","","required",""],[1,"modalEditar"],["matInput","","formControlName","email_editar","ngDefaultControl","","required",""],[1,"modalEliminar"],[1,"modalEliminarSeleccion"],[1,"caution"]],template:function(e,i){if(e&1){let r=v();s(0,"main")(1,"section",4)(2,"h1"),l(3,"Newsletters"),o(),s(4,"button",5),E("click",function(){return N(r),C(i.modalCrearNewsletter())}),l(5,"A\xF1adir suscripci\xF3n"),o()(),s(6,"section",6),_(7,ne,1,5,"app-datatable",7)(8,ae,2,0,"p"),o()(),_(9,oe,6,1,"ng-template",null,0,h)(11,se,6,1,"ng-template",null,1,h)(13,le,2,1,"ng-template",null,2,h)(15,ce,5,0,"ng-template",null,3,h)}e&2&&(p(7),M(i.newsletters?7:8))},dependencies:[k,D,X,z,G,B,j,$,L,q,O,P,H,Q,I,V],styles:["main[_ngcontent-%COMP%]{margin:0 2rem}.encabezado[_ngcontent-%COMP%]{margin:1rem 0}h1[_ngcontent-%COMP%]{font-size:var(--lengthLg1)}button.nuevo[_ngcontent-%COMP%]{color:var(--dark)}.newsletter-form[_ngcontent-%COMP%]{min-width:150px;width:100%!important}@media (min-width: 1024px){.newsletter-form[_ngcontent-%COMP%]{min-width:300px}}@media (min-width: 1440px){.newsletter-form[_ngcontent-%COMP%]{min-width:400px}}.example-full-width[_ngcontent-%COMP%]{width:100%}.caution[_ngcontent-%COMP%]{color:red}"]})};export{Y as NewslettersComponent};
