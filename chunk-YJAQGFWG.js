import{a as q,b as F}from"./chunk-LR6ULQRQ.js";import"./chunk-IZUREK7C.js";import"./chunk-QBB5J64S.js";import{b as O}from"./chunk-6IJVIIZO.js";import"./chunk-NAR25S56.js";import"./chunk-VCCA6JQD.js";import"./chunk-FFMKZHPZ.js";import{a as w}from"./chunk-6WR63XHK.js";import{a as H}from"./chunk-HCF5RDTS.js";import"./chunk-3RE7YTIY.js";import"./chunk-Y6YWBKM7.js";import"./chunk-Q674NIMA.js";import"./chunk-FIRHHLGJ.js";import{c as I,d as M}from"./chunk-C2S65IAN.js";import{a as D,c as R}from"./chunk-7YSBFMG3.js";import"./chunk-I2N33OYR.js";import"./chunk-CARY4E7O.js";import{j as A}from"./chunk-EKD5RMQ3.js";import{$b as g,Eb as _,Jb as a,Kb as r,Lb as x,Pb as y,Sb as B,Ub as c,_b as b,ac as f,bb as d,cb as l,e as v,ec as s,ga as p,gc as k,ka as S,mc as T,ta as P,tb as u,ua as C,vc as h,yb as E}from"./chunk-X7VXIKXH.js";var Q=["contentEliminar"],j=["contentEliminarSeleccion"];function V(i,t){if(i&1){let e=y();a(0,"app-datatable",6),B("selectionChange",function(o){P(e);let m=c();return C(m.onSelectionChange(o))}),r()}if(i&2){let e=c();E("columns",e.columns)("displayedColumns",e.displayedColumns)("data",e.posts)("eliminarSeleccionados",e.modalEliminarSeleccionPosts.bind(e))("buttons",e.botones)}}function z(i,t){i&1&&(a(0,"p"),s(1,"No hay posts."),r())}function N(i,t){if(i&1&&(a(0,"div",7),s(1),r()),i&2){let e=c();d(),k(' \xBFEst\xE1s seguro de querer eliminar el post "',e.post.titulo,'"? ')}}function $(i,t){i&1&&(a(0,"div",8),s(1," \xBFEst\xE1s seguro de querer las suscripciones seleccionadas? "),x(2,"br"),a(3,"span",9),s(4,"\xA1OJO! Si has pulsado el bot\xF3n para seleccionar todo, se eliminar\xE1n todos los posts, incluidas aquellas que no aparezcan en la vista actual."),r()())}var L=class i{constructor(t,e,n,o){this.postService=t;this.dialogService=e;this.datatableService=n;this.snackbar=o}posts=[];post={};columns=["titulo","slug"];displayedColumns=["select",...this.columns,"acciones"];selectedIds=[];suscripcion=new v;router=p(I);title=p(A);modalEliminar;modalEliminarSeleccion;botones=[{id:1,nombre:"Ver",class:"ver",accion:t=>this.verPost(t)},{id:2,nombre:"Editar",class:"editar",accion:t=>this.editarPost(t)},{id:3,nombre:"Eliminar",class:"danger",accion:t=>this.modalEliminarPost(t)}];ngOnInit(){this.title.setTitle("Blog < Cl\xEDnica veterinaria La Huella"),this.getPosts(),this.suscripcion=this.postService.refresh$.subscribe(()=>{this.getPosts()})}getPosts(){this.postService.getPosts({}).subscribe({next:t=>{this.posts=t.data},error:t=>{console.error(t)}})}getPost(t){this.postService.getPostById(t).subscribe({next:e=>{Array.isArray(e.data)?this.post=e.data[0]:this.post=e.data},error:e=>{e.status===404?this.snackbar.open("Post no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}verPost(t){this.postService.getPostById(t).subscribe({next:e=>{e.data[0].estado==="publicado"?this.router.navigate(["/blog",e.data[0].slug]):this.snackbar.open("Post no publicado.","Aceptar",{duration:3e3})},error:e=>{console.error(e)}})}editarPost(t){this.router.navigate([`admin/blog/${t}/editar`])}modalEliminarPost(t){let e="Eliminar post",n="eliminar",o="cancelar";this.getPost(t),this.dialogService.openDialog({html:this.modalEliminar,title:e,btnClass:n,btnCancel:o}).then(m=>{m&&this.eliminarPost(t)})}eliminarPost(t){this.postService.deletePost(t).subscribe({next:e=>{this.snackbar.open("Post eliminado.","Aceptar",{duration:3e3})},error:e=>{e.status===404?this.snackbar.open("Post no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}modalEliminarSeleccionPosts(){this.dialogService.openDialog({html:this.modalEliminarSeleccion,title:"Eliminar posts",btnClass:"eliminar",btnCancel:"cancelar"}).then(o=>{o&&this.eliminarPosts()})}eliminarPosts=()=>{this.postService.deletePosts(this.selectedIds).subscribe({next:t=>{this.datatableService._observable$.next(),this.snackbar.open("Posts eliminados.","Aceptar",{duration:3e3})},error:t=>{this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})};onSelectionChange(t){this.selectedIds=t}static \u0275fac=function(e){return new(e||i)(l(w),l(O),l(q),l(H))};static \u0275cmp=S({type:i,selectors:[["app-blog"]],viewQuery:function(e,n){if(e&1&&(b(Q,5),b(j,5)),e&2){let o;g(o=f())&&(n.modalEliminar=o.first),g(o=f())&&(n.modalEliminarSeleccion=o.first)}},standalone:!0,features:[T],decls:13,vars:1,consts:[["contentEliminar",""],["contentEliminarSeleccion",""],[1,"encabezado","flex","flex-row","items-center","gap-6"],["mat-stroked-button","","routerLink","nuevo",1,"nuevo"],[1,"posts"],[3,"columns","displayedColumns","data","eliminarSeleccionados","buttons"],[3,"selectionChange","columns","displayedColumns","data","eliminarSeleccionados","buttons"],[1,"modalEliminar"],[1,"modalEliminarSeleccion"],[1,"caution"]],template:function(e,n){e&1&&(a(0,"main")(1,"section",2)(2,"h1"),s(3,"Blog"),r(),a(4,"button",3),s(5,"A\xF1adir entrada"),r()(),a(6,"section",4),u(7,V,1,5,"app-datatable",5)(8,z,2,0,"p"),r()(),u(9,N,2,1,"ng-template",null,0,h)(11,$,5,0,"ng-template",null,1,h)),e&2&&(d(7),_(n.posts?7:8))},dependencies:[F,R,D,M],styles:["main[_ngcontent-%COMP%]{margin:0 2rem}.encabezado[_ngcontent-%COMP%]{margin:1rem 0}h1[_ngcontent-%COMP%]{font-size:var(--lengthLg1)}button.nuevo[_ngcontent-%COMP%]{color:var(--dark)}"]})};export{L as BlogComponent};
