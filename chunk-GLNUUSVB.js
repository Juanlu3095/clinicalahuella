import{a as Et}from"./chunk-AGNOH7LY.js";import{a as _t}from"./chunk-J2R2NX6D.js";import{b as Ct}from"./chunk-6IJVIIZO.js";import"./chunk-NAR25S56.js";import{a as gt,b as ft}from"./chunk-FFMKZHPZ.js";import{a as ht}from"./chunk-6WR63XHK.js";import{a as vt}from"./chunk-HCF5RDTS.js";import{a as bt}from"./chunk-3TZ6EMP4.js";import{a as Z,c as pt,d as ut}from"./chunk-3RE7YTIY.js";import{a as mt,e as ct,f as dt}from"./chunk-Y6YWBKM7.js";import{b as tt,d as s,f as et,g as it,h as nt,j as p,l as ot,o as at,p as rt,q as lt,s as st}from"./chunk-Q674NIMA.js";import{a as $}from"./chunk-FIRHHLGJ.js";import{a as Y}from"./chunk-ABJ3EAOD.js";import{a as Q,d as j}from"./chunk-C2S65IAN.js";import{a as K,b as W,c as X}from"./chunk-7YSBFMG3.js";import"./chunk-I2N33OYR.js";import"./chunk-CARY4E7O.js";import{j as G,ka as J}from"./chunk-EKD5RMQ3.js";import{$b as x,Bb as O,Eb as w,Hb as I,Ib as F,Jb as i,Kb as e,Lb as c,Mb as R,Nb as L,Pb as _,Sb as h,Ub as v,Xb as T,Ya as M,Zc as U,_b as E,ac as P,ad as B,bb as m,d as S,dc as D,e as A,ec as o,fc as N,ga as u,gd as q,ka as k,mc as V,oc as z,ta as g,tb as b,ua as f,vc as H,yb as d}from"./chunk-X7VXIKXH.js";var Pt=["imagenActual"],yt=["imagenNueva"],Mt=["AIchat"],wt=(a,n)=>n.id,St=a=>({"margin-top":a});function At(a,n){if(a&1){let t=_();i(0,"div",17,4)(2,"div",31)(3,"h2"),o(4,"Imagen actual"),e()(),c(5,"img",32),i(6,"div",31)(7,"button",33),h("click",function(){g(t);let l=v();return f(l.nuevaImagen())}),o(8,"Nueva imagen"),e()()()}if(a&2){let t=v();m(5),T("src",t.filesEndPoint+t.post.imagen,M)}}function kt(a,n){if(a&1){let t=_();R(0),c(1,"img",34),i(2,"button",35),h("click",function(){let l;g(t);let C=v(),y=D(47);return y.value="",f((l=C.postEditarForm.get("imagen"))==null?null:l.setValue(null))}),i(3,"mat-icon"),o(4,"close"),e()(),L()}if(a&2){let t=v();m(),d("src",t.postEditarForm.get("imagen").value,M)}}function Ot(a,n){a&1&&(i(0,"div",36)(1,"mat-icon",37),o(2,"file_upload"),e(),i(3,"button",38),o(4,"Browser"),e(),i(5,"small",39),o(6,"Arrastra la imagen aqu\xED"),e()())}function It(a,n){if(a&1&&(i(0,"mat-option",40),o(1),e()),a&2){let t=n.$implicit;d("value",t.id),m(),N(t.nombre)}}function Ft(a,n){if(a&1&&I(0,It,2,2,"mat-option",40,wt),a&2){let t=v();F(t.categorias)}}function Rt(a,n){a&1&&c(0,"app-aichat")}var xt=class a{categoriasService=u(_t);postService=u(ht);snackbar=u(vt);activatedRoute=u(Q);title=u(G);categorias=[];post={};idPost=0;suscripcion=new A;imagenActual={};imagenNueva={};filesEndPoint=$.DriveEndPoint;aiChat;responsiveService=u(bt);positionDialogueRight="5rem";positionDialogueLeft="";chatAbierto=!1;dialogService=u(Ct);postEditarForm=new nt({titulo:new p("",s.compose([s.required,s.minLength(1)])),slug:new p("",s.compose([s.required,s.minLength(1)])),contenido:new p("",s.minLength(1)),categoria:new p(null),imagen:new p(null,s.minLength(1)),estado:new p("borrador",s.compose([s.required,s.minLength(1)])),keywords:new p("",s.minLength(1)),metadescripcion:new p("",s.minLength(1))});ngOnInit(){this.idPost=this.activatedRoute.snapshot.params.id,this.getCategories(),this.getPost(this.idPost),this.responsiveDesign()}ngOnDestroy(){this.dialogService.closeAll(),this.suscripcion.unsubscribe()}getCategories(){this.categoriasService.getCategories().subscribe({next:n=>{this.categorias=n.data},error:n=>{n.status===404?this.snackbar.open("Categor\xEDas no encontradas.","Aceptar",{duration:3e3}):this.snackbar.open("Error al obtener las categor\xEDas.","Aceptar",{duration:3e3})}})}getPost(n){this.postService.getPostById(n).subscribe({next:t=>{Array.isArray(t.data)?this.post=t.data[0]:this.post=t.data,this.title.setTitle(`Editar: ${this.post.titulo} < Cl\xEDnica veterinaria La Huella`),this.postEditarForm.patchValue({titulo:this.post.titulo,slug:this.post.slug,contenido:this.post.contenido,keywords:this.post.keywords,metadescripcion:this.post.metadescription,categoria:this.post.categoriaId,estado:this.post.estado})},error:t=>{t.status===404?this.snackbar.open("Post no encontrado.","Aceptar",{duration:3e3}):this.snackbar.open("No se ha podido obtener los posts.","Aceptar",{duration:3e3})}})}nuevaImagen(){this.imagenActual.nativeElement.classList.contains("oculto")||this.imagenActual.nativeElement.classList.add("oculto"),this.imagenNueva.nativeElement.classList.contains("oculto")&&this.imagenNueva.nativeElement.classList.remove("oculto")}editarPost(){if(this.postEditarForm.valid){let n={titulo:this.postEditarForm.value.titulo||"",slug:this.postEditarForm.value.slug||"",contenido:this.postEditarForm.value.contenido||"",categoriaId:this.postEditarForm.value.categoria||null,estado:this.postEditarForm.value.estado||"borrador",keywords:this.postEditarForm.value.keywords||"",metadescription:this.postEditarForm.value.metadescripcion||""};this.postEditarForm.value.imagen!=null&&Object.assign(n,{imagen:this.postEditarForm.value.imagen}),this.postService.updatePost(this.idPost,n).subscribe({next:t=>{this.snackbar.open("Post actualizado.","Aceptar",{duration:3e3})},error:t=>{t.status===422?this.snackbar.open("Los campos del post no son correctos.","Aceptar",{duration:3e3}):this.snackbar.open("Ha ocurrido un error.","Aceptar",{duration:3e3})}})}}enviarImagen(n){let t=n.target;if(t?.files?.[0]){let r=t.files[0],l=new FileReader;l.addEventListener("load",()=>{this.postEditarForm.get("imagen")?.setValue(l.result)}),l.readAsDataURL(r)}}abrirAiChat(){return S(this,null,function*(){let n="Asistente IA",t="no-scroll-dialog",r={right:this.positionDialogueRight,bottom:"5rem"},l=!1;this.chatAbierto=!0,yield this.dialogService.openDialog({html:this.aiChat,title:n,position:r,hasBackdrop:l,panelClass:t}),this.chatAbierto=!1})}responsiveDesign(){this.suscripcion=this.responsiveService.obtenerDispositivo().subscribe(n=>{n==="M\xF3vil"?this.positionDialogueRight="":this.positionDialogueRight="5rem"})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["app-post-editar"]],viewQuery:function(t,r){if(t&1&&(E(Pt,5),E(yt,5),E(Mt,5)),t&2){let l;x(l=P())&&(r.imagenActual=l.first),x(l=P())&&(r.imagenNueva=l.first),x(l=P())&&(r.aiChat=l.first)}},standalone:!0,features:[V],decls:70,vars:13,consts:[["autosize","cdkTextareaAutosize"],["imagenNueva",""],["fileInput",""],["AIchat",""],["imagenActual",""],[1,"encabezado"],["routerLink","/admin/blog"],[1,"post-data",3,"formGroup"],[1,"post-content"],[1,"input-border"],[1,"field-full-width"],["matInput","","type","text","formControlName","titulo"],["matInput","","type","text","formControlName","slug","placeholder","El slug debe ser \xFAnico."],["matInput","","formControlName","contenido","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","10"],["matInput","","type","text","formControlName","keywords","placeholder","Palabras clave separadas por coma."],["matInput","","formControlName","metadescripcion","placeholder","Resumen corto del contenido de la entrada. No puede tener m\xE1s de 160 caracteres.","cdkTextareaAutosize","","cdkAutosizeMinRows","5","cdkAutosizeMaxRows","10"],[1,"post-attributes"],[1,"input-border","imagenActual"],["appearance","fill"],[1,"fileUploadContainer",3,"ngStyle"],[4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","fxLayoutGap","10px",4,"ngIf"],["type","file","multiple","multiple","accept","image/*",1,"fileInput",3,"change"],["matInput","","formControlName","imagen","readonly","",3,"hidden"],["formControlName","categoria","ngDefaultControl",""],["required","","formControlName","estado","ngDefaultControl",""],["value","publicado"],["value","borrador"],["mat-flat-button","","type","submit",1,"btn-submit",3,"click"],[1,"btn-ai",3,"click","disabled"],["fontIcon","smart_toy",1,"ai-icon"],[1,"text-center"],["alt","Imagen actual del post",3,"src"],["mat-flat-button","",1,"btn-nuevaimg",3,"click"],[3,"src"],["mat-icon-button","",1,"deleteButton",3,"click"],["fxLayout","column","fxLayoutAlign","center center","fxLayoutGap","10px"],[2,"opacity","60%"],["mat-raised-button","",2,"width","100%","opacity","80%","color","var(--lightbrown)"],[2,"margin","20px"],[3,"value"]],template:function(t,r){if(t&1){let l=_();i(0,"main")(1,"section",5)(2,"h1"),o(3,"Editar entrada"),e(),i(4,"a",6),o(5,"\u2190 Volver atr\xE1s"),e()(),i(6,"form",7)(7,"section",8)(8,"div",9)(9,"mat-form-field",10)(10,"mat-label"),o(11,"T\xEDtulo"),e(),c(12,"input",11),e()(),i(13,"div",9)(14,"mat-form-field",10)(15,"mat-label"),o(16,"Slug"),e(),c(17,"input",12),e()(),i(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),o(21,"Contenido de la entrada"),e(),c(22,"textarea",13,0),e()(),i(24,"div",9)(25,"h2"),o(26,"SEO"),e(),i(27,"mat-form-field",10)(28,"mat-label"),o(29,"Palabras clave"),e(),c(30,"input",14),e(),i(31,"mat-form-field",10)(32,"mat-label"),o(33,"Meta descripci\xF3n"),e(),c(34,"textarea",15,0),e()()(),i(36,"aside",16),b(37,At,9,1,"div",17),i(38,"div",null,1)(40,"mat-form-field",18)(41,"mat-label"),o(42,"Imagen"),e(),i(43,"div",19),b(44,kt,5,1,"ng-container",20)(45,Ot,7,0,"div",21),i(46,"input",22,2),h("change",function(y){return g(l),f(r.enviarImagen(y))}),e()(),c(48,"input",23),e()(),i(49,"div",9)(50,"mat-form-field",10)(51,"mat-label"),o(52,"Categor\xEDa"),e(),i(53,"mat-select",24),b(54,Ft,2,0),e()()(),i(55,"div",9)(56,"mat-form-field",10)(57,"mat-label"),o(58,"Estado"),e(),i(59,"mat-select",25)(60,"mat-option",26),o(61,"Publicado"),e(),i(62,"mat-option",27),o(63,"Borrador"),e()()(),i(64,"button",28),h("click",function(){return g(l),f(r.editarPost())}),o(65,"Guardar"),e()()()(),i(66,"button",29),h("click",function(){return g(l),f(r.abrirAiChat())}),c(67,"mat-icon",30),e()(),b(68,Rt,1,0,"ng-template",null,3,H)}t&2&&(m(6),d("formGroup",r.postEditarForm),m(31),w(r.post.imagen!=null?37:-1),m(),O(r.post.imagen!=null?"input-border oculto":"input-border"),m(5),d("ngStyle",z(11,St,r.postEditarForm.get("imagen").value?"5px":"20px")),m(),d("ngIf",r.postEditarForm.get("imagen").value),m(),d("ngIf",!r.postEditarForm.get("imagen").value),m(3),d("hidden",!0),m(6),w(r.categorias?54:-1),m(12),d("disabled",r.chatAbierto))},dependencies:[st,ot,tt,et,it,lt,at,rt,q,U,B,j,dt,ct,mt,ut,pt,Z,ft,gt,J,Y,X,K,W,Et],styles:['@charset "UTF-8";main[_ngcontent-%COMP%]{margin:0 2rem}.encabezado[_ngcontent-%COMP%]{margin:1rem 0}.encabezado[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:var(--lengthMd1);color:var(--lightbrown)}h1[_ngcontent-%COMP%]{font-size:var(--lengthLg1);color:#000}.post-data[_ngcontent-%COMP%]{display:flex;gap:2rem}@media (max-width: 767px){.post-data[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}}.input-border[_ngcontent-%COMP%]{padding:1rem 1rem 0;margin-bottom:1rem;border:1px solid var(--lightbrown);background-color:#fff}.field-full-width[_ngcontent-%COMP%]{width:100%}.post-content[_ngcontent-%COMP%]{width:70%}@media (max-width: 767px){.post-content[_ngcontent-%COMP%]{width:100%}}.post-attributes[_ngcontent-%COMP%]{width:30%}@media (max-width: 767px){.post-attributes[_ngcontent-%COMP%]{width:100%}}.input-border[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem}.input-border[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:-webkit-fill-available}.imagenActual[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding:1rem}.oculto[_ngcontent-%COMP%]{display:none}button.btn-nuevaimg[_ngcontent-%COMP%]{margin-top:1rem;background-color:var(--lightbrown);color:#fff}.fileUploadContainer[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;margin:0 auto;width:auto;height:150px;border:dashed 1px #979797;text-align:center;justify-content:center}.fileUploadContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;max-height:100%;max-width:100%}.fileUploadContainer[_ngcontent-%COMP%]   .noImageContainet[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:11px}.fileUploadContainer[_ngcontent-%COMP%]   .noImageContainet[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:11px}.fileUploadContainer[_ngcontent-%COMP%]   .deleteButton[_ngcontent-%COMP%]{position:absolute;z-index:10;top:0;inset-inline-end:-10px;opacity:50%;color:red}.fileUploadContainer[_ngcontent-%COMP%]   .fileInput[_ngcontent-%COMP%]{position:absolute;z-index:9;opacity:0;height:100%;width:100%;left:0;top:0;cursor:pointer}button.btn-submit[_ngcontent-%COMP%]{background-color:var(--lightbrown);color:#fff;margin-bottom:1rem}.btn-ai[_ngcontent-%COMP%]{position:fixed;bottom:0;right:0;margin:0 2.5rem 1.5rem 0}.ai-icon[_ngcontent-%COMP%]{transform:scale(2);color:var(--dark);filter:drop-shadow(0 0 1px rgba(0,0,0,.8))}']})};export{xt as PostEditarComponent};
